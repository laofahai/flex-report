# 任务优先级管理

## 🎯 当前任务状态

### 🔥 最高优先级 (立即执行)

#### 1. Starter 应用功能验证 🔄 **进行中**

**依赖**: 无  
**阻塞**: 所有后续开发任务  
**预计完成**: 完成 CLI 问题修复后 1-2 天

**具体任务**:

- [x] 修复 CLI 命令格式问题 (发现是 `plugin:list` 而非 `plugin-list`)
- [x] 修复插件加载问题 (重新启用了被注释的 `loadPlugins()` 调用)
- [x] 验证插件发现机制正常工作 (@linch-kit/schema 插件被正确发现)
- [x] 完成插件加载验证 (✅ 插件加载成功，1个插件已加载)
- [x] 验证 Schema 命令功能 (✅ `pnpm linch schema:list` 和其他命令正常工作)
- [x] 修复 monorepo 插件发现路径 (✅ 添加 `packages/*` 到搜索路径)
- [x] 添加 `pnpm linch` 命令支持 (✅ 添加到根 package.json)

**成果**: CLI 系统完全正常，9个实体成功加载，所有 schema 命令可用

### 🔥 当前最高优先级任务 (立即执行)

**上一个任务已完成**: auth-core 包链接问题已修复 ✅

#### 1. 修复 auth-core 包链接问题 ✅ **已完成**

**状态**: ✅ 已完成
**完成时间**: 2025-06-20
**解决方案**:
- 修复了 schema 插件中的包导入路径 (从 `../../packages/` 改为 `packages/`)
- 在 schema 包中添加了对 auth-core 的 peerDependencies 声明
- 验证了 auth-core 实体正常加载

**成果**: 消除了 "Cannot find package '@linch-kit/auth-core'" 警告，9个实体全部正常加载

#### 2. 完善 @linch-kit/trpc 包 ✅ **已完成**

**状态**: ✅ 已完成
**完成时间**: 2025-06-20
**解决方案**:
- 创建了完整的 tRPC 服务端配置和上下文管理
- 实现了 Next.js App Router 兼容的 API 路由
- 配置了客户端 tRPC React Query 集成
- 创建了用户 CRUD 操作的路由模板
- 验证了 API 端点正常工作 (GET /api/trpc/user.list 返回正确响应)

**成果**: Starter 应用现在支持类型安全的 tRPC API 调用，为后续功能开发奠定了基础

### 🔴 高优先级 (本周完成)

#### 3. linch-starter 基座应用最小功能集 ✅ **已完成 (2025-06-20)**

**状态**: ✅ 已完成 (前端认证集成完成)
**紧急度**: 8/10 (验证架构可行性)
**完成时间**: 2025-06-20

**具体任务**:
- [x] Next.js 15 + tRPC 客户端/服务端集成 ✅
- [x] 认证流程配置 (自定义认证系统) ✅
- [x] Prisma 数据库操作集成 ✅
- [x] 基础页面结构和路由 ✅
- [x] 用户管理界面完成 ✅
- [x] 前端认证上下文管理 ✅
- [x] 路由保护组件 ✅
- [x] 会话状态持久化 ✅

**成功标准**: ✅ 完整的认证流程，基础 CRUD 操作，权限验证

#### 4. 产品管理模块开发 📦 **当前最高优先级**

**状态**: 📋 待开始
**紧急度**: 8/10 (业务功能扩展)
**预计完成**: 2025-06-22 (2-3天)

**具体任务**:
- [ ] 产品实体和 Schema 定义
- [ ] 产品 CRUD API 实现
- [ ] 产品管理前端界面
- [ ] 产品分类和库存管理
- [ ] 产品搜索和筛选功能

**成功标准**: 完整的产品管理系统，与用户管理系统集成

### 🟡 中优先级 (下周开始)

#### 5. @linch-kit/crud-ui 通用组件 🎨 **UI 生态**

**状态**: 📋 待开始
**紧急度**: 6/10 (提升开发效率)
**预计完成**: 2025-07-05 (1-2周)

**具体任务**:
- [ ] React Hooks 实现 (useCRUD, useCRUDList, useCRUDForm)
- [ ] 列表组件实现 (CRUDList, DataTable)
- [ ] 表单组件实现 (CRUDForm, 字段组件)
- [ ] 详情和布局组件
- [ ] Storybook 和文档

**成功标准**: 完整的 CRUD UI 组件库，与 @linch-kit/crud 包深度集成

#### 6. Auth UI 组件集成 🔐 **认证体验**

**状态**: 📋 待开始
**紧急度**: 5/10 (用户体验优化)
**预计完成**: 2025-07-10 (1周)

**具体任务**:
- [ ] 认证组件 (LoginForm, RegisterForm, AuthGuard)
- [ ] 权限门控组件 (PermissionGate, RoleGate)
- [ ] 用户管理界面
- [ ] 多提供商认证支持

**成功标准**: 完整的认证 UI 组件，用户体验优秀

### 🟢 低优先级 (长期规划)

#### 7. AI 能力集成 🤖 **智能增强**

**状态**: 📋 规划中
**时机评估**: **现在引入为时过早**
**建议开始时间**: 完成 starter 验证后 (2-3周后)

**分阶段实施**:
- **第一阶段** (2-3周后): 开发工具增强
  - Schema 智能分析和建议
  - CLI 命令智能提示
  - 错误诊断和修复建议
- **第二阶段** (1-2个月后): 业务功能增强
  - 动态报表生成
  - 接口调试助手
  - 智能表单生成
- **第三阶段** (2-3个月后): 生态系统增强
  - 向量知识库
  - 智能代码生成
  - 业务流程优化

#### 5. 生产级应用基础 📋 **依赖: 完成 Auth UI**

**预计完成**: Auth UI 完成后 3-4 天

**具体任务**:

- [ ] 完整的 Next.js 应用集成所有包
- [ ] 认证流程和 CRUD 界面
- [ ] 管理仪表板
- [ ] 生产就绪的部署配置

### 🟢 低优先级 (长期规划)

#### 6. 插件系统核心 📋 **依赖: 完成生产基础**

**预计完成**: 生产基础完成后 4-6 天

#### 7. 系统集成和优化 📋 **依赖: 完成插件系统**

**预计完成**: 插件系统完成后 3-4 天

#### 8. 示例模块和验证 📋 **依赖: 完成系统集成**

**预计完成**: 系统集成完成后 2-3 天

## 🚧 技术债务优先级

### 🔥 紧急技术债务

#### 1. 架构不一致问题 ⚠️ **新发现，需要立即解决**

**问题**: 配置与实现不一致
- 配置指定使用 `simplified` 实体套件（JSON 优先架构）
- 实际 Prisma schema 和 tRPC 实现使用关联表方式
- 可能导致功能冲突和维护困难

**解决方案选项**:
- 选项A: 统一使用 JSON 字段（符合配置，简化架构）
- 选项B: 统一使用关联表（保持当前实现，修改配置）

#### 2. CLI 系统稳定性 🔧 **部分已修复**

- [x] 插件加载流程已修复 (重新启用插件加载)
- [x] 命令格式问题已解决 (使用冒号分隔符)
- [ ] 配置文件统一
- [ ] 错误处理和帮助信息优化
- [ ] CLI 启动时的输出问题需要调试

#### 2. 测试覆盖 📋 **高优先级**

- 单元测试框架建立
- 集成测试用例
- 自动化测试流程

### 🟡 重要技术债务

#### 3. 文档完善 📋 **中优先级**

- API 文档详细化
- 使用案例和示例
- 错误处理指南

#### 4. 性能优化 📋 **中优先级**

- 大型 Schema 生成性能
- CLI 工具启动速度
- 内存使用优化

## 📊 任务依赖关系图

```
修复 auth-core 包链接 ✅ (已完成)
    ↓
完善 tRPC 包 ✅ (已完成)
    ↓
linch-starter 基座应用 🔄 (进行中，1-2天)
    ↓
用户管理功能实现 (2-3天)
    ↓
CRUD UI 包开发 (1-2周)
    ↓
Auth UI 组件集成 (1周)
    ↓
AI 能力集成 (长期规划)
```

## ⚠️ 风险评估与缓解

### 🔴 高风险项目

#### 1. tRPC 包集成复杂度
**风险**: 与 auth-core、schema 的深度集成可能引入类型冲突
**缓解策略**:
- 分步集成，先完成基础功能再添加高级特性
- 建立完整的类型测试用例
- 使用 TypeScript 严格模式确保类型安全

#### 2. Monorepo 依赖管理
**风险**: workspace 依赖解析问题可能导致运行时错误
**缓解策略**:
- 统一使用 `workspace:*` 依赖声明
- 建立依赖图验证脚本
- 定期执行完整构建验证

### 🟡 中等风险项目

#### 3. Next.js 15 + React 19 兼容性
**风险**: 新版本可能存在未知兼容性问题
**缓解策略**:
- 建立完整的集成测试
- 准备降级方案 (Next.js 14 + React 18)
- 密切关注社区反馈

## 🎯 每日工作重点

### 当前工作重点 (今天 - 2025-06-20)

1. ✅ **已完成**: 修复 auth-core 包链接问题
2. ✅ **已完成**: tRPC 包集成和验证
3. ✅ **已完成**: linch-starter 基座应用前端认证集成
4. ✅ **已完成**: AuthGuard userRoles 错误修复 (2025-06-20 晚)
5. **下一步**: 架构不一致问题解决和产品管理模块开发

### 今晚完成的紧急修复 (2025-06-20 晚)

#### AuthGuard userRoles 错误修复 ✅ **已完成**

**问题**: `src/components/auth/auth-guard.tsx:110` 行出现 `userRoles is undefined` 错误
**解决方案**:
- ✅ 在 `hasRequiredRoles` 函数中添加空值保护：`const roles = userRoles || []`
- ✅ 修复 tRPC `register` 路由返回用户对象缺少 `roles` 字段
- ✅ 确保认证流程返回一致的用户对象结构
- ✅ 通过 ESLint 代码质量检查

**成果**: AuthGuard 组件现在能正确处理新注册用户，认证流程完全稳定

#### 发现的架构不一致问题 ⚠️ **需要解决**

**问题**: 配置指定使用 `simplified` 实体套件（JSON 优先架构），但实际实现使用关联表
**具体表现**:
- `linch.config.js` 中 `entityKit: 'simplified'` 指定使用 JSON 字段存储角色
- 但当前 Prisma schema 包含 `UserRole` 关联表
- tRPC 认证逻辑基于关联表查询用户角色

**影响**: 架构设计与实际实现不一致，可能导致功能冲突

### 明天工作重点 (2025-06-21)

1. **架构统一决策**: 确定使用 JSON 字段还是关联表存储角色
2. **基座应用稳定性评估**: 用户体验、错误处理、性能优化
3. **UI 设计系统规划**: 使用 shadcn/ui 组件重新设计界面方案

### 本周工作重点 (2025-06-21 - 2025-06-25)

1. **周一**: 架构不一致问题解决，基座应用稳定性评估
2. **周二-周三**: UI 设计系统完善，shadcn/ui 组件集成
3. **周四-周五**: @linch-kit/crud-ui 包开发计划制定和初步实现

### 下周工作重点 (2025-06-26 开始)

1. **第1周**: @linch-kit/crud-ui 包开发 (组件设计、API 接口、集成方式)
2. **第2周**: 发布流程建立 (自动化构建、版本管理、npm 发布)
3. **第3周**: 文档完善和示例创建
4. **第4周**: 生产级应用示例和部署配置

## 🔍 风险评估

### 高风险任务

1. **CLI 系统修复**: 可能涉及架构调整
2. **包集成验证**: 可能发现设计问题
3. **插件系统**: 复杂度高，可能需要重新设计

### 缓解措施

1. **分步验证**: 每个包单独验证后再集成
2. **文档先行**: 设计文档完善后再实现
3. **测试驱动**: 关键功能先写测试

## 📈 成功指标

### 短期指标 (1周内)

- [x] auth-core 包链接问题解决 ✅
- [x] tRPC 包构建成功，无类型错误 ✅
- [x] starter 应用可以正常启动和运行 ✅
- [x] 用户注册/登录流程完整可用 ✅
- [x] 前端认证集成完成 ✅

### 中期指标 (1个月内)

- [ ] 完整的 CRUD 操作界面
- [ ] 权限控制系统验证通过
- [ ] 所有核心包集成测试通过
- [ ] 性能基准达到预期目标

### 长期指标 (2-3个月内)

- [ ] 完整的 UI 组件生态
- [ ] AI 能力初步集成
- [ ] 生产级应用示例
- [ ] 完整的开发者文档

---

**最后更新**: 2025-06-20
**相关文档**: [当前进度](./current-progress.md) | [开发路线图](./roadmap.md)
