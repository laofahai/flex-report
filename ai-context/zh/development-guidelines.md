# LinchKit 开发规范指南

**最后更新**: 2025-06-21 15:30

## 🚨 强制性开发要求

### UI 包 (packages/ui) 核心改进要求

#### 国际化支持 (强制要求)
- **参考实现**: 必须参考 `packages/auth-core/src/i18n/` 的实现模式
- **实现标准**: 确保所有 UI 组件支持多语言
- **语言包要求**: 提供完整的中英文语言包
- **一致性要求**: 与 auth-core 的 i18n 系统保持一致的 API 设计
- **默认行为**: 当翻译键未实现时，提供默认回退模式如 'ui.componentName.fieldName'

#### 第三方组件封装策略 (强制要求)
- **适度封装原则**: 对复杂第三方组件进行适度封装，避免过度封装导致功能受限
- **原生 API 保留**: 提供 `...props` 透传机制，确保用户可直接使用第三方组件的高级特性
- **封装层次**: 
  - 基础层：提供简化的常用 API
  - 高级层：保留完整的原生 API 访问能力
- **文档要求**: 必须在组件文档中说明如何访问原生 API

#### 表格组件架构要求 (强制要求)
- **Schema 集成**: 必须基于 `@linch-kit/schema` 定义实现高级筛选功能
- **核心功能**: 支持动态列配置、排序、分页等核心功能
- **类型安全**: 提供类型安全的筛选器 API
- **扩展性**: 支持自定义筛选器和排序逻辑
- **性能优化**: 支持虚拟滚动和大数据集处理

#### CRUD 组件设计原则 (强制要求)
- **Schema 驱动**: 深度集成 `@linch-kit/schema`，支持 schema 驱动的表单生成
- **Schema 扩展**: 扩展 schema 定义以支持 CRUD 组件的配置选项
- **开发者体验**: 优先考虑开发者体验和组件扩展性
- **生命周期钩子**: 提供完整的 CRUD 操作生命周期钩子
- **错误处理**: 统一的错误处理和用户反馈机制

### 包架构强制要求

#### 整体架构观察原则 (强制要求)
`packages/*` 下所有包存在相互依赖关系，修改任何包内容时必须：

1. **影响范围分析**: 分析对其他包的影响范围
2. **类型兼容性检查**: 检查类型定义的兼容性
3. **依赖链验证**: 验证依赖链的完整性
4. **版本兼容性确保**: 确保版本兼容性
5. **同步更新**: 同步更新相关包的依赖和类型定义

#### 包重命名评估 (待决策)
- **当前状态**: 考虑将 `auth-core` 重命名为 `auth`
- **原因**: 已放弃 `auth-ui` 包开发，`auth-core` 名称不再必要
- **影响评估**: 需要评估对现有代码和文档的影响
- **迁移策略**: 如果执行重命名，需要制定平滑的迁移策略

## 📋 开发流程要求

### 代码修改前置检查
在修改任何包代码前，必须执行以下检查：

1. **依赖关系分析**
   ```bash
   # 检查包间依赖关系
   pnpm list --depth=0
   # 分析影响范围
   ```

2. **类型检查**
   ```bash
   # 检查当前包类型
   cd packages/[package-name] && pnpm check-types
   # 检查相关包类型
   ```

3. **构建验证**
   ```bash
   # 验证构建成功
   cd packages/[package-name] && pnpm build
   ```

### 代码修改后验证
完成代码修改后，必须执行以下验证：

1. **全局类型检查**
   ```bash
   # 检查所有包的类型兼容性
   pnpm check-types
   ```

2. **构建验证**
   ```bash
   # 验证所有包构建成功
   pnpm build
   ```

3. **功能测试**
   ```bash
   # 启动测试应用
   cd apps/linch-starter && pnpm dev
   # 验证相关功能正常
   ```

## 🎯 质量标准

### 代码质量要求
- **TypeScript 严格模式**: 所有代码必须通过 TypeScript 严格模式检查
- **ESLint 规范**: 遵循项目 ESLint 配置
- **文档完整性**: 所有公开 API 必须有完整的 JSDoc 文档
- **测试覆盖**: 核心功能必须有相应的测试用例

### 性能要求
- **包体积控制**: 支持 tree-shaking，避免不必要的包体积增加
- **按需导入**: 支持按需导入，减少应用打包体积
- **运行时性能**: 组件渲染性能不得明显下降
- **内存管理**: 避免内存泄漏，正确清理事件监听器

### 兼容性要求
- **向后兼容**: 新版本必须保持向后兼容性
- **浏览器兼容**: 支持现代浏览器 (Chrome 90+, Firefox 88+, Safari 14+)
- **React 版本**: 兼容 React 18+ 和 React 19
- **Node.js 版本**: 兼容 Node.js 18+ 和 Node.js 20+

## 📚 文档要求

### API 文档
- **JSDoc 注释**: 所有公开函数和组件必须有详细的 JSDoc 注释
- **使用示例**: 提供完整的使用示例代码
- **类型定义**: 导出完整的 TypeScript 类型定义
- **变更日志**: 记录 API 变更和迁移指南

### 组件文档
- **属性说明**: 详细说明所有组件属性
- **事件回调**: 说明所有事件回调的参数和用途
- **样式定制**: 说明如何定制组件样式
- **最佳实践**: 提供使用最佳实践和常见问题解决方案

## 🔄 持续改进

### 定期评估
- **架构评估**: 每月评估包架构的合理性
- **性能评估**: 定期进行性能基准测试
- **用户反馈**: 收集和分析用户反馈，持续改进
- **技术债务**: 定期清理技术债务，重构过时代码

### 版本管理
- **语义化版本**: 严格遵循语义化版本规范
- **变更日志**: 维护详细的变更日志
- **迁移指南**: 为破坏性变更提供迁移指南
- **LTS 支持**: 为长期支持版本提供维护

## 🚨 违规处理

### 代码审查
- **强制审查**: 所有代码变更必须经过代码审查
- **自动检查**: 使用 CI/CD 自动检查代码质量
- **阻断机制**: 不符合规范的代码不得合并到主分支

### 质量门禁
- **类型检查**: 类型检查失败阻断发布
- **构建验证**: 构建失败阻断发布
- **测试通过**: 测试失败阻断发布
- **文档完整**: 文档不完整阻断发布

---

**注意**: 本文档是强制性开发规范，所有开发人员必须严格遵守。违反规范的代码将被拒绝合并。
