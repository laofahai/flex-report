# LinchKit AI 全面理解与自主任务执行路线图

## 1. 最终目标

实现 AI 对 LinchKit 项目的**全面、深入、持续的理解**，从而能够：

1.  **与用户高效协作**：AI 能够理解用户讨论的开发任务，并将其结构化保存。
2.  **自主执行任务**：AI 能够按照任务规划，独立、可靠地执行开发任务，减少人工干预和纠正次数。
3.  **避免信息不全面错误**：AI 能够基于完整的项目上下文进行决策和编码，避免因信息碎片化导致的错误。

## 2. 核心支柱

为实现上述目标，我们将围绕以下四个核心支柱构建能力：

1.  **全面且结构化的知识库 (Comprehensive & Structured Knowledge Base)**：AI 能够访问所有项目信息，且信息以机器可读、易于解析的格式存在。
2.  **智能知识检索与推理 (Intelligent Knowledge Retrieval & Reasoning - Graph RAG)**：AI 能够高效地查询、关联和推理知识库中的信息，构建对项目深层次的理解。
3.  **标准化任务定义与执行 (Standardized Task Definition & Execution)**：AI 能够清晰地理解任务指令，并以可追踪、可验证的方式执行任务。
4.  **持续学习与反馈循环 (Continuous Learning & Feedback Loop)**：AI 能够从每次交互和执行中学习，不断优化其理解和执行能力。

## 3. 实现路线图 (分阶段迭代)

我们将采取迭代式开发的方法，从小范围开始，逐步扩展功能和数据源。

### 阶段 0：基础与准备 (当前状态与近期行动)

*   **目标**：建立核心文档标准，并为 AI 驱动的知识提取做准备。
*   **关键活动**：
    *   **最终确定文档化方案**：确认 `TEMP_DOCUMENTATION_PLAN.md` 中的文档化策略已获批准。
    *   **创建 `ai-context/library-api/` 目录**：为 AI 友好的结构化 API 文档预留空间。
    *   **启动核心包/模块文档化任务 (Claude Code)**：根据 `TEMP_DOCUMENTATION_PLAN.md` 中的新标准，开始文档化核心 `packages` 和 `modules`（例如 `auth`, `core`, `console`）。这包括更新 `README.md` 和创建 `ai-context/library-api/*.md` 文件。
    *   **最终确定战略性 AI 文档**：确保所有 `ai-context/architecture/*.md` 和 `ai-context/core/*.md`（如 `graph_rag_strategy.md`, `observability_strategy.md` 等）已完成并获批准。

### 阶段 1：知识图谱 MVP (Claude Code 与 Gemini 协作)

*   **目标**：构建初始知识图谱，并实现基本的 AI 查询能力。
*   **关键活动**：
    *   **选择并设置图数据库 (Claude Code)**：选择并部署一个图数据库实例（例如，通过 Docker 部署 Neo4j 或 ArangoDB）。
    *   **开发初始数据提取器 (Claude Code)**：
        *   `package.json` 解析器（用于提取 `DEPENDS_ON` 关系）。
        *   `ai-context/library-api/*.md` 解析器（用于提取 `DEFINES`, `EXPORTS`, `DOCUMENTS` 关系）。
        *   `@linch-kit/schema` 解析器（用于提取 `HAS_FIELD`, `HAS_RELATION` 关系）。
    *   **开发数据导入管道 (Claude Code)**：编写脚本将提取的数据加载到图数据库中。
    *   **开发基本图谱查询服务 (Claude Code)**：实现一个简单的 API 端点，能够执行图数据库查询（例如 Cypher/AQL）。
    *   **集成基本图谱查询工具 (Gemini)**：将图谱查询服务封装为 AI 可调用的工具（例如 `query_linchkit_graph(query: str)`）。
    *   **初步提示工程 (Gemini)**：训练 Gemini 使用此工具进行基本查询（例如，“包 X 的作用是什么？”、“包 Y 的依赖项有哪些？”）。

### 阶段 2：增强理解与任务定义 (Gemini 与 Claude Code)

*   **目标**：深化 AI 对代码结构的理解，并建立标准化的任务执行框架。
*   **关键活动**：
    *   **开发高级数据提取器 (Claude Code)**：
        *   TypeScript AST 解析器（用于提取 `CALLS`, `USES_TYPE`, `IMPLEMENTS`, `EXTENDS` 关系）。
        *   解析 `DESIGN.md` 和 `README.md` 中的高层概念和关系（可能需要结合 NLP 技术）。
    *   **完善图谱查询服务 (Claude Code)**：增加更复杂的查询能力（例如影响分析、使用模式）。
    *   **标准化任务文档格式 (Gemini 与 Claude Code)**：定义清晰的 Markdown 格式的任务文档（例如 `ai-context/tasks/*.md`），包括：
        *   任务标题、描述、目标。
        *   验收标准 (Acceptance Criteria)。
        *   子任务列表（包含状态：`TODO`, `IN_PROGRESS`, `DONE`）。
        *   相关文件/模块链接。
        *   讨论/备注。
    *   **开发任务解析与执行器 (Claude Code)**：实现一个组件，能够读取、解析和更新这些任务文档。
    *   **集成任务管理工具 (Gemini)**：将任务管理功能封装为 AI 可调用的工具（例如 `read_task_document(path)`, `update_task_status(path, subtask_id, status)`, `add_task_note(path, note)`）。
    *   **任务执行提示工程 (Gemini)**：训练 Gemini：
        *   读取并理解任务文档。
        *   将任务分解为可执行的步骤。
        *   利用 Graph RAG 收集每个步骤所需的上下文。
        *   执行步骤（例如 `write_file`, `replace`, `run_shell_command`）。
        *   更新任务状态。
        *   处理错误并寻求澄清。

### 阶段 3：自主执行与持续改进 (Gemini 与 Claude Code)

*   **目标**：实现更自主的任务执行，并建立持续学习的反馈循环。
*   **关键活动**：
    *   **自动化验证 (Claude Code)**：将 `bun validate`, `bun test`, `bun lint` 等集成到任务执行流程中，允许 AI 自我验证更改。
    *   **自动化文档更新 (Claude Code)**：开发脚本，能够根据代码更改自动更新 `ai-context/library-api/*.md`（例如，新的导出）。
    *   **反馈循环与学习 (Gemini)**：
        *   当发生手动纠正时，Gemini 分析其理解/行动与预期结果之间的差异。
        *   利用此反馈优化提示工程，改进工具使用，或识别知识图谱中的空白。
        *   建立机制，允许 Gemini 建议改进数据提取器或图谱 Schema。
    *   **主动上下文收集 (Gemini)**：训练 Gemini 在开始任务前主动查询知识图谱以收集相关上下文，预测潜在问题。

### 阶段 4：高级 AI 能力 (未来扩展)

*   **集成其他 AI-First 策略**：将可观测性、策略即代码、AI 辅助代码生成等策略集成进来，充分利用已建立的知识图谱。
*   **AI 辅助调试与故障排除**。
*   **自动化性能优化**。

### 战略性重心转移：立即构建基础

**决策**：为了实现 AI 对项目的全面理解并显著减少手动纠正次数，我们决定**立即将重心转移到构建核心基础能力上**。这不是暂停开发，而是一项关键的、有时间限制的投资，旨在为未来的开发带来巨大的效率提升。

**原因**：
1.  **解决核心痛点**：解决“做 app 时容易出现架构错误”的问题，避免随着项目复杂度增加而恶化。
2.  **避免“越来越麻烦”**：越早投入标准化文档和知识图谱建设，成本越低，收益越大。
3.  **赋能 AI 的基石**：标准化文档和知识图谱是 AI 实现深度理解和自主任务执行的不可或缺的基础。

**执行方式**：
*   **明确优先级**：将“标准化文档化”和“知识图谱 MVP 构建”设置为当前最高优先级任务。
*   **时间盒 (Time-box)**：为这个阶段设定一个明确的时间盒（例如，2-4周），集中资源完成核心部分。
*   **Claude Code 集中攻坚**：Claude Code 将集中精力执行 `TEMP_DOCUMENTATION_PLAN.md` 中定义的文档化任务，并启动 `ai-context/architecture/graph_rag_strategy.md` 中规划的知识图谱 MVP 构建。
*   **Gemini 规划与监督**：Gemini 将继续与用户协商，规划具体的实施细节，并监督 Claude Code 的进展，确保其符合战略目标。

## 4. 用户注意事项

在重心转移阶段，作为用户，您需要注意以下几点：

1.  **内部沟通与对齐 (如果涉及团队)**：
    *   **明确优先级转变**：与团队成员、项目经理或相关利益方沟通，明确告知当前开发工作的重心将暂时转移。
    *   **解释原因**：解释这样做的长期收益，以获得他们的理解和支持。
2.  **资源与时间盒**：
    *   **集中资源**：确保 Claude Code 能够集中精力攻坚这些任务。
    *   **设定时间盒**：根据实际情况和团队能力，设定一个实际可行的、有明确截止日期的“时间盒”。
3.  **对 AI (Claude Code) 的预期管理**：
    *   **初期输出**：Claude Code 在初期会主要产出大量的文档内容以及数据提取和图谱构建的脚本。这些是基础设施，可能不会立即看到直接的功能性改进。
    *   **迭代性**：知识图谱的构建是一个迭代过程，需要逐步完善。
    *   **交互模式**：Claude Code 在执行任务时，会按照我们之前讨论的模式，提出具体的编码方案，并等待您的确认。
4.  **您的参与**：
    *   **积极审阅**：积极审阅 Claude Code 产出的文档内容和编码方案，您的反馈至关重要。
    *   **决策支持**：在关键决策点，您可能需要提供明确的指导。
    *   **耐心与信任**：这是一个基础性建设阶段，需要一定的耐心。
5.  **持续的反馈循环**：
    *   **及时纠正**：如果在文档化或图谱构建过程中发现任何不符合预期的地方，请立即指出。
    *   **记录经验**：我们可以一起记录这个过程中的经验教训，不断优化协作模式和 AI 的工作流程。
6.  **技术栈确认**：
    *   **Neo4j AuraDB Free**：如果您决定使用这个免费服务，请确保您已经注册并获取了必要的连接凭证。Claude Code 在需要时会向您索取这些信息。

## 5. 关键促成因素

*   **持续一致的文档化工作**：不断地按照标准化要求文档化 `packages` 和 `modules` 是知识图谱的生命线。
*   **CI/CD 集成**：自动化图谱更新和验证，确保知识的实时性和准确性。
*   **清晰的沟通**：用户、Gemini 和 Claude Code 之间保持清晰、明确的沟通，是项目成功的基石。

通过遵循这个路线图，我们将逐步构建一个强大的 AI 辅助开发系统，使 LinchKit 项目的开发变得前所未有的高效和智能。
