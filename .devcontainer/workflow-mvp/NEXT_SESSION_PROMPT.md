# LinchKit AI 驱动工作流 - 下一个 Session 继续指令

## 🎯 Session 背景
当前已完成 LinchKit AI 自动化工作流 Phase 1 的核心功能实现，成功演示了从自然语言到完整AI驱动开发的端到端流程。但发现了关键的环境约束逻辑矛盾需要紧急修复。

## 🚨 **立即需要解决的关键问题**

### **问题**: 环境约束逻辑矛盾
- **现状**: 工作流执行会生成/修改文件，但环境约束要求工作目录必须干净
- **影响**: 第一个工作流执行后，后续工作流都无法启动，破坏连续自动化
- **优先级**: 最高

## 📋 **下一个 Session 的具体任务**

### 🔴 **主要任务1: 修复环境约束矛盾**

1. **分析现有约束逻辑**
   - 阅读 `scripts/ai-workflow-generator.sh` 的 `enforce_environment_constraints` 函数
   - 理解当前工作目录检查逻辑

2. **设计新的环境管理策略**
   - 区分工作流生成的文件 vs 用户修改
   - 实现智能文件分类和自动处理
   - 支持工作流自动提交机制

3. **实现解决方案**（选择其一）:
   - **方案A**: 智能忽略工作流生成的文件
   - **方案B**: 自动提交工作流生成的文件  
   - **方案C**: 在 worktree 中执行工作流，避免污染主分支

### 🔴 **主要任务2: 完成场景演示**

完成剩余两个关键场景的端到端演示：

1. **UI 组件场景**
   ```
   用户输入: "创建用户管理的数据表格组件，支持增删改查"
   预期: AI 自动识别为 UI 任务，生成相关工作流并执行
   ```

2. **API 重构场景**  
   ```
   用户输入: "重构用户 API，添加批量操作和搜索功能"
   预期: AI 自动识别为 API 任务，生成相关工作流并执行
   ```

### 🟡 **次要任务3: 系统优化**

1. **修复技术债务**
   - 修复 `engine.sh` 第208行的 `CONFIG_FILE` 变量未绑定问题
   - 清理调试输出和临时文件

2. **增强 AI 能力**
   - 优化任务类型识别准确性
   - 改进 Gemini 协商机制集成

## 🎯 **期望的 Session 结果**

### **必须完成**:
- ✅ 修复环境约束矛盾，实现真正的连续自动化
- ✅ 成功演示 UI 组件自动化开发场景
- ✅ 成功演示 API 重构自动化开发场景

### **成功标准**:
1. **连续执行测试**: 能够连续运行多个工作流而无需手动干预
2. **三大场景完整**: JWT认证 + UI组件 + API重构 全部演示成功
3. **用户体验**: 用户只需提供自然语言，AI完成所有开发工作

## 📂 **重要文件位置**

```
工作目录: /home/laofahai/workspace/linch-kit/.devcontainer/workflow-mvp/
核心脚本: scripts/ai-workflow-generator.sh (关键的环境约束函数)
执行引擎: engine.sh (CONFIG_FILE 变量错误位置)  
状态管理: state/ (执行状态跟踪)
任务配置: tasks/ (生成的工作流配置)
进度报告: SESSION_PROGRESS.md (当前成就总结)
```

## 🚀 **启动指令**

### **Claude 开始新 Session 时，请执行**:

1. **切换到正确目录**:
   ```bash
   cd /home/laofahai/workspace/linch-kit/.devcontainer/workflow-mvp
   ```

2. **读取进度状态**:
   ```bash
   cat SESSION_PROGRESS.md
   ```

3. **检查当前分支和状态**:
   ```bash
   git branch --show-current
   git status --short
   ```

4. **读取待办任务**:
   ```bash
   # 使用 TodoRead 查看当前任务列表
   ```

5. **开始修复环境约束问题**:
   ```bash
   # 分析 scripts/ai-workflow-generator.sh 中的 enforce_environment_constraints 函数
   # 设计并实现解决方案
   ```

## 💡 **提示**

- **核心目标**: 实现真正的"用户只需自然语言，AI自动完成所有工作"
- **关键挑战**: 平衡自动化便利性和代码质量控制
- **成功指标**: 连续执行多个自然语言任务而无需手动干预

**这是 LinchKit AI-First 开发框架的关键里程碑！** 🎯